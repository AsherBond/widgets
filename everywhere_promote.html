<!DOCTYPE html>
<html>
<head>
	<script src="local.js"></script>
	<script src="api_key.js"></script>
</head>
<body>
	
		<script id="mupcss" type="text/javascript" charset="utf-8">
			// Dynamic variables in CSS via JavaScript
			// Default Variables
			var	MUPCSS_PBACKGROUND = '#1A1A1A',
					MUPCSS_PTEXT = '#f2f2f2',
					MUPCSS_SBACKGROUND = '#333',
					MUPCSS_STEXT = '#f2f2f2',
					MUPCSS_LINK = '#26B';
			
			function get_css() {
				var the_css = '\
				.mup-widget {\
					font-family: "lucida grande", lucida, tahoma, helvetica, arial, sans-serif !important;\
					font-size: 12px;\
				}\
				#mup-widget-1 .mup-doc,\
				#mup-widget-1 .mup-hd a {\
					background: MUPCSS_PBACKGROUND;\
					color: MUPCSS_PTEXT;\
				}\
				#mup-widget-1 .mup-doc {\
					border-radius: 5px;\
					-moz-border-radius: 5px;\
					-webkit-border-radius: 5px;\
					width: 195px;\
				}\
				#mup-widget-1 .mup-hd {\
					padding: 10px 8px;\
					overflow: hidden;\
				}\
				.mup-widget h3,\
				.mup-widget h4,\
				.mup-widget p {\
					line-height: 1.2 !important;\
					margin: 0px !important;\
					padding: 0px !important;\
					text-align: center;\
				}\
				#mup-widget-1 h3 {\
					font-size: 15px;\
					font-weight: normal;\
				}\
				#mup-widget-1 h4 {\
					font-size: 13px;\
					font-weight: normal;\
				}\
				#mup-widget-1 h5 {\
					font-size: 20px;\
					margin: 0 auto;\
					text-align: center;\
					letter-spacing: -1px;\
					text-shadow: 1px 1px 1px MUPCSS_PBACKGROUND;\
				}\
				.mup-widget p {\
					text-align: center;\
				}\
				#mup-widget .mup-bd,\
				#mup-widget .mup-timeline,\
				#mup-widget .mup-bd p {\
					color: MUPCSS_STEXT;\
				}\
				.mup-bd {\
					//margin: 0 8px;\
					//padding: 12px 6px;\
				}\
				#mup-widget-1 .mup-timeline {\
					background: MUPCSS_SBACKGROUND;\
				}\
				a,\
				a:active,\
				a:visited,\
				a:hover {\
					color: MUPCSS_LINK;\
					text-decoration: none;\
				}\
				.mup-timeline {\
					list-style: none;\
					padding: 0;\
					margin: 0;\
					height: 300px;\
					overflow-y: auto;\
				}\
				.mup-timeline > li {\
					position: relative;\
					border-top-color: #DDD;\
					border-top-style: dotted;\
					border-top-width: 1px;\
					padding: 6px 8px;\
				}\
				.mup-list {\
					list-style: none;\
					padding: 0;\
					margin: 0 8px;\
					background: MUPCSS_SBACKGROUND;\
					border-radius: 5px;\
					-moz-border-radius: 5px;\
					-webkit-border-radius: 5px;\
				}\
				.mup-list > li {\
					padding: 12px 6px;\
					border-top-color: MUPCSS_PBACKGROUND;\
					border-top-style: solid;\
					border-top-width: 1px;\
				}\
				.mup-ft {\
					//border-top-color: #DDD;\
					//border-top-style: solid;\
					//border-top-width: 1px;\
					padding: 6px 8px;\
				}\
				.mup-ft div {\
					padding: 6px 8px;\
					font-size: 8px;\
					text-align: center;\
				}\
				.mup-tlabel {\
					font-size: 8px;\
					color: #AAA;\
				}\
				.mup-rsvp {\
					display:block;\
					margin-bottom: 6px;\
					text-align: center;\
				}\
				.mup-button {\
					display:block;\
					margin: 0 auto;\
					padding: 6px 6px;\
					background-color: MUPCSS_LINK;\
					background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#2266BB), to(#102f56));\
					background: -moz-linear-gradient(0% 100% 90deg,#102F56, #2266BB);\
					border-radius: 5px;\
					-moz-border-radius: 5px;\
					-webkit-border-radius: 5px;\
					font-size: 15px;\
					font-weight: bold;\
					color: MUPCSS_PTEXT !important;\
					text-align: center;\
					border: 1px solid #0d2748;\
				}\
				';

				return the_css;
			}
			
			function write_css() {
				var js2css = get_css();
				// Replace variables with code
				js2css = js2css.replace(/MUPCSS_PBACKGROUND/g, MUPCSS_PBACKGROUND);
				js2css = js2css.replace(/MUPCSS_PTEXT/g, MUPCSS_PTEXT);
				js2css = js2css.replace(/MUPCSS_SBACKGROUND/g, MUPCSS_SBACKGROUND);
				js2css = js2css.replace(/MUPCSS_STEXT/g, MUPCSS_STEXT);
				js2css = js2css.replace(/MUPCSS_LINK/g, MUPCSS_LINK);
				// Write it
				document.write('<style type="text/css" media="screen">'+ js2css +'</style>');
			}
			write_css();
		</script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
		<script id="config" type="text/javascript" charset="utf-8">
         
         var $parameters = {
            urlname: "etsy-craft-party",
            width: 300,
            height: 400,
            event_id: 12992,
            _name: "Everywhere Mashup",
            _description: "Shows past meetups and aggregates tagged content from other services."
         };
         var $queries = {
            event: function() {
               return api_call("/ew/events", {event_id: $parameters.event_id, fields: "rsvp_count"});
            }
         };
      </script>
		<script type="text/javascript" charset="utf-8">
			// Set global variables
			var resultCount = 0;
			
			// Functions
			function onload() {
				$('body').append('<div id="mup-widget-1" class="mup-widget"><div class="mup-doc"></div></div>');
			}
			onload();
			
			function getFormattedAddress( _venue, _street, _city, _state, _zip ) {
				if ( _venue != null ) {
					var  venue = _venue;
					var address = venue;
				} else {
					var venue = 'Venue TBD';
					var address = venue;
				}
				
				if ( _street != null ) {
					var street = _street;
					address += '<br />' + street;
				} else {
					var street = '';
				}
				
				if ( _city != null ) {
					var city = _city;
					address += '<br />' + city;
				} else {
					var city = '';
				}
				
				if ( _state != null ) {
					var state = _state;
					address += ', ' + state;
				} else {
					var state = '';
				}
				
				if ( _zip != null ) {
					var zip = _zip;
					address += ' ' + zip;
				} else {
					var zip = '';
				}
				return address;
			}
			
			function addLink( content, link ) {
				return '<a href="' + link + '">' + content + '</a>';
			}
			
			function initCountdown( mupTimeMillis ) {
				
				window.muptimer = parseFloat( mupTimeMillis );
				var end = 0;
				var refresh = 1000; // Refresh rate in milliseconds
				
				if( window.muptimer >= end ) {
					muptime = setTimeout( 'updateCountdown( "true" )', refresh );
				} else {
					updateCountdown( false );
				}
			}
			
			function updateCountdown( state ) {
				if( state ) {
					// Start time has not yet been reached
					// Calculate the number of days left
					var days=Math.floor(window.muptimer / 86400000); 
					// After deducting the days calculate the number of hours left
					var hours = Math.floor((window.muptimer - (days * 86400000 ))/3600000);
					// After days and hours , how many minutes are left 
					var minutes = Math.floor((window.muptimer - (days * 86400000 ) - (hours *3600000 ))/60000);
					// Finally how many seconds left after removing days, hours and minutes. 
					var secs = Math.floor((window.muptimer - (days * 86400000 ) - (hours *3600000 ) - (minutes*60000)) / 1000);
					
					var update = days + '<span class="mup-tlabel"> DAYS &nbsp; </span>' + hours + '<span class="mup-tlabel"> HR &nbsp; </span>' + minutes + '<span class="mup-tlabel"> MIN &nbsp; </span>' + secs + '<span class="mup-tlabel"> SEC</span>';
					document.getElementById('timer').innerHTML = update;
					window.muptimer = window.muptimer - 1000;
					tt=initCountdown( window.muptimer );
				}
				else if ( !state ) {
					// Event start time has been reached or is in the past
					console.info('Meetup has begun or is in the past. Do something here!');
				}
			}
			
			$.getJSON($queries.event(), function(data) {

		    //$("#mup_everywhere_bare_stats").width($parameters.width);
				//$("#mup_everywhere_bare_stats").height($parameters.height);
		    if (data.status && data.status.match(/^200/) == null) {
		       alert(data.status + ": " + data.details);
		    } else {
		      var event = data.results[0];
					var eventTime = event.time;
					// My code here.
					
					$(document).ready(function() {
						$('.mup-doc').append(
							'<div class="mup-hd">' +
								'<h4><span id="timer" style="display:block; height: 16px;"></span></h4>' +
								'<span class="mup-tlabel" style="display:block; padding:8px 0 2px; text-align:center; letter-spacing: 1px;">REMAINING UNTIL</span>' +
							'</div>' +
							'<div class="mup-bd"><ul class="mup-list">' +
								'<li><p><h5>' + addLink( event.container.name + '<br />Meetup', event.meetup_url )+ '</h5></p></li>' +
								'<li><p>' + getFormattedAddress( event.venue_name, event.address1, event.city, event.state, event.zip ) + '</p></li>' +
								'<li><span class="mup-rsvp">' + addLink( event.rsvp_count + ' people', event.meetup_url ) + '</span>' +
								addLink ( '<span class="mup-button" style="width:140px; margin-bottom:6px;">Interested?</span>', event.meetup_url ) +
								'<span class="mup-rsvp">Not near ' + event.city + '?<br/>' + addLink( 'Find a ' + event.container.name + ' meetup near you!', 'http://www.meetup.com/' + event.container.urlname + '/' ) + '</li>' +
							'</ul></div>' +
							'<div class="mup-ft">' +
								'<img src="http://img1.meetupstatic.com/84869143793177372874/img/birddog/everywhere_widget.png">' +
							'</div>'
							);
							initCountdown( function(){
								var now = new Date();
								var event = new Date( eventTime );
								var diff = event.getTime() - now.getTime();
								return diff;
							}() );
					});
		    }
		  });
		</script>
</body>
</html>