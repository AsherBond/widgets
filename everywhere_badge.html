<html>
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
	<script src="local.js"></script>
	<script src="api_key.js"></script>
	<script id="config" type="text/javascript" charset="utf-8">
	  var $parameters = {
	    urlname: "etsy-craft-party",
	    width: 200,
			_height: 200,
	    _name: "Everywhere Badge",
	    _description: "Shows past meetups and aggregates tagged content from other services."
	  };
	  var $queries = {
	    containers: function() { 
	      return api_call("/ew/containers", {urlname: $parameters.urlname, fields: "meetup_count,past_meetup_count,member_count,geo_ip"});
	    }
	  };
	</script>
	<link rel=stylesheet href="mup_reset.css" type="text/css" media=screen>
	<script type="text/javascript" charset="utf-8">
		with_jquery(function($) {
			// Functions
			function addLink( content, link ) {
				return '<a href="' + link + '">' + content + '</a>';
			}

			$.getJSON($queries.containers(), function(data) {
		    if (data.status && data.status.match(/^200/) == null) {
			       alert(data.status + ": " + data.details);
		    } else {
				container = data.results[0];
					$(document).ready(function() {
						$('#mup-widget-2').append(
							'<div class="mup-doc">' +
								'<div class="mup-bd">' +
									'<h3>' + container.name + '</h3>' +
									'<span class="mup-stats">' + (container.meetup_count+container.past_meetup_count) + '<span class="mup-tlabel"> MEETUPS</span> <span style="color:#000">|</span> ' + container.member_count + '<span class="mup-tlabel"> PEOPLE</span></span>' +
									'<div style="overflow:hidden;"><span style="font-size:11px; float:left; display:block; padding:2px 0 0 3px;">Find a meetup near you </span><span class="mup-button" style="float:right;margin-right:2px;">GO</span></div>' +
								'</div>' +
								'<div class="mup-ft">' +
									'<div class="mup-logo"><img src="http://img1.meetupstatic.com/84869143793177372874/img/birddog/everywhere_widget.png"></div>' +
									'<div class="mup-getwdgt">' + addLink( 'ADD THIS TO YOUR SITE', container.meetup_url ) + '</div>' +
								'</div>' +
							'</div>'
							);
					});
		    }
		  });
			// Dynamic variables in CSS via JavaScript
			// Default Variables
			var	MUPCSS_PBACKGROUND = '#1A1A1A',
					MUPCSS_PTEXT = '#f2f2f2',
					MUPCSS_SBACKGROUND = '#333',
					MUPCSS_STEXT = '#f2f2f2',
					MUPCSS_LINK = '#f2f2f2';
					MUPCSS_WIDTH = $parameters.width;

			function get_css() {
				var the_css = '\
				.mup-widget {\
					font-family: "lucida grande", lucida, tahoma, helvetica, arial, sans-serif !important;\
					font-size: 12px;\
				}\
				#mup-widget-2 .mup-doc,\
				#mup-widget-2 .mup-hd a {\
					background: MUPCSS_PBACKGROUND;\
					color: MUPCSS_PTEXT;\
				}\
				#mup-widget-2 .mup-doc {\
					border-radius: 5px;\
					-moz-border-radius: 5px;\
					-webkit-border-radius: 5px;\
					width: MUPCSS_WIDTH;\
					padding-top: 8px;\
				}\
				#mup-widget-2 .mup-hd {\
					padding: 10px 8px;\
					overflow: hidden;\
				}\
				.mup-widget h3,\
				.mup-widget h4,\
				.mup-widget p {\
					line-height: 1.2 !important;\
					text-align: center;\
				}\
				#mup-widget-2 h3 {\
					font-size: 15px;\
				}\
				#mup-widget-2 h4 {\
					font-size: 13px;\
				}\
				#mup-widget-2 h5 {\
					font-size: 20px;\
					margin: 0 auto;\
					text-align: center;\
					letter-spacing: -1px;\
					text-shadow: 1px 1px 1px MUPCSS_PBACKGROUND;\
				}\
				#mup-widget-2 .mup-widget p {\
					text-align: center;\
				}\
				#mup-widget-2 .mup-bd,\
				#mup-widget-2 .mup-timeline,\
				#mup-widget-2 .mup-bd p {\
					color: MUPCSS_STEXT;\
				}\
				#mup-widget-2 .mup-bd {\
					border-radius: 5px;\
					-moz-border-radius: 5px;\
					-webkit-border-radius: 5px;\
					padding: 8px 6px;\
					margin: 0 8px;\
					background: MUPCSS_SBACKGROUND;\
				}\
				a,\
				a:active,\
				a:visited,\
				a:hover {\
					color: MUPCSS_LINK;\
					text-decoration: none;\
				}\
				#mup-widget-2 .mup-tlabel {\
					font-size: 8px;\
					color: #AAA;\
				}\
				#mup-widget-2 .mup-stats {\
					display: block;\
					margin: 6px 0;\
					padding: 4px;\
					text-align: center;\
					background: MUPCSS_PBACKGROUND;\
					border-radius: 3px;\
					-moz-border-radius: 3px;\
					-webkit-border-radius: 3px;\
				}\
				#mup-widget-2 .mup-button {\
					display:block;\
					margin: 0 auto;\
					padding: 2px 4px;\
					background-color: MUPCSS_LINK;\
					background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#2266BB), to(#102f56));\
					background: -moz-linear-gradient(0% 100% 90deg,#102F56, #2266BB);\
					border-radius: 3px;\
					-moz-border-radius: 3px;\
					-webkit-border-radius: 3px;\
					font-size: 10px;\
					font-weight: bold;\
					color: MUPCSS_PTEXT !important;\
					text-align: center;\
					border: 1px solid #0d2748;\
				}\
				#mup-widget-2 .mup-ft .mup-getwdgt {\
					padding: 3px 0;\
					font-size: 8px;\
					text-align: center;\
					background: #0A0A0A;\
					-webkit-border-bottom-right-radius: 5px;\
  				-webkit-border-bottom-left-radius: 5px;\
  				-moz-border-radius-bottomright: 5px;\
  				-moz-border-radius-bottomleft: 5px;\
  				border-bottom-right-radius: 5px;\
  				border-bottom-left-radius: 5px;\
				}\
				#mup-widget-2 .mup-ft .mup-logo {\
					padding: 6px 8px;\
				}\
				';
				return the_css;
			}

			function write_css() {
				var js2css = get_css();

				// Replace variables with code
				js2css = js2css.replace(/MUPCSS_PBACKGROUND/g, MUPCSS_PBACKGROUND);
				js2css = js2css.replace(/MUPCSS_PTEXT/g, MUPCSS_PTEXT);
				js2css = js2css.replace(/MUPCSS_SBACKGROUND/g, MUPCSS_SBACKGROUND);
				js2css = js2css.replace(/MUPCSS_STEXT/g, MUPCSS_STEXT);
				js2css = js2css.replace(/MUPCSS_LINK/g, MUPCSS_LINK);
				js2css = js2css.replace(/MUPCSS_WIDTH/g, MUPCSS_WIDTH);

				// Write it
				$('head').append('<style type="text/css" media="screen">'+ js2css +'</style>');
			}
			write_css();
		});
	</script>
</head>
<body>
	<div id="mup-widget-2" class="mup-widget"></div>
</body>
</html>